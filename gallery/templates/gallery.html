{% extends "base.html" %}
{% load static %}
{% load cloudinary %}

{% block content %}

<div class="gallery-container">
    {% for folder in get_all_folders %}
    <div class="gallery-folder" data-name="{{folder.name}}">
        <div class="gallery-preview">
            {% for image in folder_images %}
            {% if image.folder == folder.path %}
            <img class="img-src" src="{{ image.secure_url }}" alt="{{folder.name}}">
            {% endif %}
            {% endfor %}
        </div>
        <h2>{{folder.name}}</h2>
    </div>
    {% endfor %}

    {% if user.is_superuser %}
    <div class="add-folder">
        <div id="add-sign">&plus;</div>
        <h2>Add New Folder</h2>
    </div>

    <div id="create-folder" class="folder-modal">
        <button class="close">&times;</button>
        <form id="folder-form" method="POST" action="{% url 'gallery' %}">
            {% csrf_token %}
            {{ folder_form}}
            <button type="submit">Create folder</button>
        </form>
    </div>

    <div id="add-image-modal">
        <button class="close">&times;</button>
        <form class="add-image" id="upload-form" method="POST" action="{% url 'upload_images' %}" enctype="multipart/form-data">
            {% csrf_token %}
            {{ upload_form.images }}
            {{ upload_form.folder }}
            <button type="submit">Upload</button>
        </form>
    </div>
    {% endif %}
</div>
<!-- Fullscreen Gallery Modal -->
<div class="gallery-modal">
    <button class="close">&times;</button>
    <div class="gallery-main">
        <img id="main-image" class="main-image" src="" alt="">
        <button class="prev">&#10094;</button>
        <button class="next">&#10095;</button>
    </div>
    <div class="gallery-thumbnails" id="thumbnail-row">
        {% if user.is_superuser %}
        <div id="add-image-button">&plus;</div>
        {% endif %}
    </div>
</div>

<script src="https://product-gallery.cloudinary.com/all.js" type="text/javascript"></script>

{% endblock %}