{% extends "base.html" %}
{% load static %}
{% load cloudinary %}

{% block content %}

<div class="gallery-container">
    {% for folder in get_all_folders %}
    <div class="gallery-folder" data-name="{{folder.name}}">
        <h2>{{folder.name}}</h2>
        <div class="gallery-preview">
            {% for image in folder_images %}
            {% if image.folder == folder.path %}
            <img class="img-src" src="{{ image.secure_url }}" alt="{{folder.name}}">
            {% endif %}
            {% endfor %}
        </div>
    </div>
    {% if user.is_superuser %}
    <div>
        <form id="upload-form" method="POST" action="{% url 'upload_images' %}" enctype="multipart/form-data">
            {% csrf_token %}
            {{ upload_form.images }}
            {{ upload_form.folder }}
            <button type="submit">Upload</button>
        </form>
    </div>
    {% endif %}
    {% endfor %}

    {% if user.is_superuser %}
    <div class="">
        <form id="folder-form" method="POST" action="{% url 'gallery' %}">
            {% csrf_token %}
            {{ folder_form}}
            <button type="submit">Create folder</button>
        </form>
    </div>
    {% endif %}
</div>
<!-- Fullscreen Gallery Modal -->
<div class="gallery-modal">
    <span class="close">&times;</span>

    <!-- Large Image Display -->
    <div class="gallery-main">
        {% for image in folder_images %}
        {% if image.folder == folder.path %}
        <div id="my-gallery" style="max-width:80%">
        </div>
        {% endif %}
        {% endfor %}
    </div>

    <!-- Thumbnail Navigation Row -->
    <div class="gallery-thumbnails"></div>
</div>

<script src="https://product-gallery.cloudinary.com/all.js" type="text/javascript"></script>
<script>
    const yearBoxes = document.querySelectorAll(".gallery-folder");
    const modal = document.querySelector(".gallery-modal");
    const closeModal = document.querySelector(".gallery-modal .close");
    yearBoxes.forEach(box => {
        box.addEventListener("click", function () {
            const folderName = this.getAttribute("data-name");
            settings = {
                cloud_name: "vikmath1119",
                api_key: "657483658624369",
                api_secret: "L2P4QumKhynBnPopLuaVz9h505k",
                folder: { path: "wheels-next-the-sea", resource_type: "image" },
            }
            const myGallery = cloudinary.galleryWidget(settings, {
                container: "#my-gallery",
                cloudName: "vikmath1119",
                mediaAssets: [{ tag: folderName }],    // by default mediaType: "image"
            });
            myGallery.render();
            modal.style.display = "flex";
        });
    });
    closeModal.addEventListener("click", function () {
        modal.style.display = "none";
    });

    modal.addEventListener("click", function (event) {
        if (event.target === modal) {
            modal.style.display = "none";
        }
    });
</script>
{% endblock %}